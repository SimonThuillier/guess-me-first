var _e=Object.defineProperty,He=Object.defineProperties;var Ke=Object.getOwnPropertyDescriptors;var ye=Object.getOwnPropertySymbols;var Je=Object.prototype.hasOwnProperty,We=Object.prototype.propertyIsEnumerable;var be=(e,n,a)=>n in e?_e(e,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[n]=a,D=(e,n)=>{for(var a in n||(n={}))Je.call(n,a)&&be(e,a,n[a]);if(ye)for(var a of ye(n))We.call(n,a)&&be(e,a,n[a]);return e},X=(e,n)=>He(e,Ke(n));import{v as Ue,r as g,u as _,j as t,N as xe,C as Se,P as f,a as d,F as ne,b as p,A as Q,B as R,c as Ye,d as Ne,e as I,f as Xe,R as M,g as b,M as Qe,h as Ze,s as j,i as et,p as tt,k as nt,l as Ce,m as rt,T as at,O as Z,n as ot,o as we,q as Ie,t as U,L as it,w as st,x as ct,y as H,z as lt,D as dt}from"./vendor.e86aecd8.js";const ut=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function a(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerpolicy&&(i.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?i.credentials="include":r.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(r){if(r.ep)return;r.ep=!0;const i=a(r);fetch(r.href,i)}};ut();function $(){return Math.floor(Date.now()/1e3)}function K(e,n){const[a,o]=g.exports.useState(()=>{try{const i=window.localStorage.getItem(e);return i?JSON.parse(i):n}catch(i){return console.log(i),n}});return[a,i=>{try{const s=i instanceof Function?i(a):i;o(s),window.localStorage.setItem(e,JSON.stringify(s))}catch(s){console.log(s)}}]}function mt(){const e=window.localStorage.getItem("playerId");return!!(e?JSON.parse(e):null)}function P(){const e=window.localStorage.getItem("playerId");return(e?JSON.parse(e):null)||""}function ht(){const e=`u_${Ue()}`;return window.localStorage.setItem("playerId",JSON.stringify(e)),e}function ft(){const e=window.localStorage.getItem("playerName"),n=e?JSON.parse(e):null;return n!==null&&!!n&&`${n}`.length>=3}function re(){const e=window.localStorage.getItem("playerName");return(e?JSON.parse(e):null)||""}function gt(e){let n=[],a=e;function o(){return a}function r(l){a!==l&&(a=l,n.forEach(c=>c(a)))}function i(l){return n.push(l),()=>s(l)}function s(l){n=n.filter(c=>c!==l)}return{get:o,set:r,subscribe:i}}function Ee(){var e,n;return typeof window.innerWidth!="undefined"?(e=window.innerWidth,n=window.innerHeight):typeof document.documentElement!="undefined"&&typeof document.documentElement.clientWidth!="undefined"&&document.documentElement.clientWidth!=0?(e=document.documentElement.clientWidth,n=document.documentElement.clientHeight):(e=document.getElementsByTagName("body")[0].clientWidth,n=document.getElementsByTagName("body")[0].clientHeight),[e,n]}function Re(){const[e,n]=g.exports.useState(Ee());return g.exports.useEffect(()=>{function a(){const o=Ee();n(o)}return window.addEventListener("resize",a),()=>{window.removeEventListener("resize",a)}}),e}const pt=function(){const e=_();return t(xe,{bg:"dark",variant:"dark",fixed:"top",children:t(Se,{children:t(xe.Brand,{onClick:()=>{e("/")},children:"Guess me First !"})})})},F=e=>{const n=Re();return d(ne,{children:[t(pt,{}),t("div",{style:{position:"absolute",top:"48px",x:"0px",height:`${n[1]-48}px`,width:"100%"},children:t(Se,{fluid:!0,className:e.vcenter?"vertical-center":"",children:e.children})})]})};F.propTypes={vcenter:f.any};const Te=e=>e.trim().length>=3;function ke(e){const[n,a]=K("playerName",null),[o,r]=g.exports.useState({playerName:n||"",valid:Te(n||""),submitted:!1});function i(c){const u=c.target.value||"";r({playerName:u,valid:Te(u),submitted:!1})}function s(){r(X(D({},o),{submitted:!1}))}function l(c){if(c.preventDefault(),!o.valid){r(X(D({},o),{submitted:!0}));return}e.onSubmit(o.playerName)}return d(p,{onSubmit:l,children:[t(Q,{show:!o.valid&&!!o.submitted,variant:"danger",onClose:s,dismissible:!0,children:t(Q.Heading,{children:"Votre nom doit faire au moins 3 caract\xE8res"})}),d(p.Group,{className:"mb-3",controlId:"playerName",children:[t(p.Label,{children:"Entrez votre nom"}),t(p.Control,{type:"text",placeholder:"nom",value:o.playerName,onChange:i}),t(p.Text,{className:"text-muted",children:"Vous apparaitrai avec ce nom sur la page de jeu."})]}),t(R,{variant:"primary",type:"submit",children:"Enregistrer"})]})}ke.propTypes={onSubmit:f.func.isRequired};function De({eventKey:e}){const n=Ye(e,()=>{});return t(R,{className:"join-game-card-button",onClick:n,variant:"success",size:"lg",children:"Rejoindre une partie"})}De.propTypes={eventKey:f.string.isRequired};function Ae({onSubmit:e}){const[n,a]=g.exports.useState({gameLink:null}),[o,r]=g.exports.useState("secondary");function i(l){const c=l.target.value||null;a({gameLink:c})}const s=()=>{const l=u=>{console.log("Pasted content: ",u),a({gameLink:u}),r("success"),setTimeout(()=>{r("secondary")},800)},c=u=>{console.error("Failed to read clipboard contents: ",u),r("danger"),setTimeout(()=>{r("secondary")},800)};try{navigator.clipboard.readText().then(l).catch(c)}catch(u){c(u)}};return t(Ne,{defaultActiveKey:"1",children:d(I,{children:[t(I.Header,{className:"join-game-card-header",children:t(De,{eventKey:"0"})}),t(Ne.Collapse,{eventKey:"0",children:d(I.Body,{children:[d(p,{onSubmit:e,children:[d(p.Group,{className:"mb-3",controlId:"gameLink",children:[t(p.Label,{children:"Entrez le lien d'invitation"}),t(p.Control,{style:{display:"inline-block",maxWidth:"85%"},type:"text",placeholder:"lien",value:n.gameLink||"",onChange:i}),"\xA0\xA0",t(R,{style:{transform:"translateY(-2px)",msTransform:"translateY(-2px)"},title:"Collez le lien",onClick:s,variant:o,children:t(Xe,{})})]}),t(R,{variant:"primary",type:"submit",children:"Rejoindre cette partie"})]}),t("small",{className:"text-muted form-text",children:"Entrez un lien d'invitation \xE0 une partie"})]})})]})})}Ae.propTypes={onSubmit:f.func.isRequired};function vt(){const[e,n]=K("playerName",null),[a,o]=g.exports.useState(!e),r=_(),s=a?t(M,{children:t(ke,{onSubmit:l=>{n(l),o(!1)}})}):t(M,{children:d(b,{children:[d("h1",{children:["Bonjour ",e]}),"\xA0",t(R,{variant:"light",onClick:()=>{o(!0)},children:"changer"})]})});return!e||e===""?t("div",{children:s}):d("div",{children:[s,t(M,{className:"menu-row",children:t("div",{className:"d-grid gap-2",children:t(R,{variant:"primary",size:"lg",onClick:()=>r("/game-configuration"),children:"Cr\xE9er une partie"})})}),t(M,{className:"menu-row",children:t("div",{className:"d-grid gap-2",children:t(Ae,{onSubmit:l=>{l.preventDefault(),r(l.target.elements.gameLink.value.replace(window.location.origin,""))}})})})]})}function Ge(){return K("playerName",null),t(F,{vcenter:!0,children:d(M,{children:[t(b,{sm:2,md:4}),t(b,{sm:8,md:4,children:t(vt,{})}),t(b,{sm:2,md:4})]})})}function Me(e){const[n,a]=g.exports.useState(Object.assign({},e.initialData,{submitted:!1})),o=i=>s=>{const l=X(D({},n),{[i]:s.target.value});a(l)};function r(i){i.preventDefault(),e.onSubmit(n)}return d(p,{onSubmit:r,children:[t("h1",{children:"Param\xE8tres de jeu"}),d(p.Group,{className:"mb-3",controlId:"roundNumber",children:[t(p.Label,{children:"Nombre de tours"}),t(p.Control,{type:"number",min:"1",max:"30",value:n.roundNumber,onChange:o("roundNumber")}),t(p.Text,{className:"text-muted",children:"Nombre d'images \xE0 trouver successivement."})]}),d(p.Group,{className:"mb-3",controlId:"choicesPerRound",children:[t(p.Label,{children:"Choix par tour"}),t(p.Control,{type:"number",min:"2",max:"10",value:n.choicesPerRound,onChange:o("choicesPerRound")}),t(p.Text,{className:"text-muted",children:"Nombre de choix propos\xE9s \xE0 chaque tour."})]}),d(p.Group,{className:"mb-3",controlId:"maxRoundTime",children:[t(p.Label,{children:"Limite de temps de tour"}),d(p.Select,{value:n.maxRoundTime,onChange:o("maxRoundTime"),children:[t("option",{value:"15",children:"15s"}),t("option",{value:"30",children:"30s"}),t("option",{value:"45",children:"45s"}),t("option",{value:"60",children:"1m"}),t("option",{value:"90",children:"1m30s"}),t("option",{value:"120",children:"2m"})]}),t(p.Text,{className:"text-muted",children:"Temps max d'un tour si des joueurs n'ont pas encore trouv\xE9."})]}),d(p.Group,{className:"mb-3",controlId:"secondsBetweenRound",children:[t(p.Label,{children:"Intervalle entre les tours"}),t(p.Control,{type:"number",min:"0",max:"600",value:n.secondsBetweenRound,onChange:o("secondsBetweenRound")}),t(p.Text,{className:"text-muted",children:"Nombre de secondes entre la fin d'un tour et le d\xE9but du suivant."})]}),t(R,{variant:"primary",type:"submit",children:"Cr\xE9er la partie"})]})}Me.propTypes={initialData:f.object.isRequired,onSubmit:f.func.isRequired};function yt(){const[e,n]=K("ownedGameConfiguration",{roundNumber:4,choicesPerRound:4,maxRoundTime:"30",secondsBetweenRound:5}),a=_();return t(F,{vcenter:!0,children:d(M,{children:[t(b,{sm:2,md:4}),t(b,{sm:8,md:4,children:t(Me,{initialData:e,onSubmit:r=>{n(r),a("/new-game")}})}),t(b,{sm:2,md:4})]})})}const ae="http://localhost:3001",bt="iamcomplete";let q=(()=>{let e;const n={},a=()=>{e=new Qe(ae,{withCredentials:!0,extraHeaders:{[bt]:"abcd"}}),e.reconnection=!0};return{getSocket:o=>(e===void 0&&(a(),e.open(r=>{console.warn(r?`Sio failed to connect to ${ae} : ${r.message}`:`Sio successfuly connected to ${ae}`)}),n["/"]=e.socket("/")),n[o]||(n[o]=e.socket(o)),n[o]),getDefaultSocket:()=>n["/"]}})();function oe(e){const{variant:n,heading:a,message:o,footer:r,onDismiss:i}=e,s=i||function(){};let l=o;return l==="xhr poll error"&&(l="Impossible de se connecter au serveur !"),d(Q,{show:!0,variant:n,onClose:s,dismissible:!0,children:[t(Q.Heading,{children:a}),t("p",{children:l}),t("hr",{}),t("p",{className:"mb-0",children:r})]})}oe.propTypes={variant:f.string.isRequired,heading:f.string.isRequired,message:f.string.isRequired,footer:f.string.isRequired,onDismiss:f.func};function xt(){const[e]=K("ownedGameConfiguration",null),[n,a]=g.exports.useState("gameCreationStatus",{status:"CONNECTING",message:null}),[o,r]=K("gameData",null),i=_(),s=()=>{const c=q.getSocket("/game");c.on("gameCreated",(...u)=>{const x=u[0];r(x),i(x.path)}),c.emit("createGame",{creatorId:P(),creatorName:re(),parameters:e}),a({status:"CREATING",message:null})},l=c=>{a({status:"ERROR",message:c.message})};if(g.exports.useEffect(()=>{const c=q.getSocket("/game");return c.connected?s():(c.off("connect").on("connect",s),c.off("connect_error").on("connect_error",l),c.connect()),()=>{c.off("connect",s),c.off("connect_error",l)}},[]),n.status==="ERROR"){const c=()=>{q.getDefaultSocket().disconnect(),q.getSocket("/game").disconnect(),i("/")};return t(F,{vcenter:!0,children:d(M,{children:[t(b,{sm:2,md:4}),t(b,{sm:8,md:4,children:t(oe,{variant:"danger",heading:"Erreur lors de la cr\xE9ation de la partie",message:n.message,onDismiss:c,footer:"Reconnexion en cours... Fermez cette alerte si vous souhaitez retourner au menu."})}),t(b,{sm:2,md:4})]})})}return t(F,{vcenter:!0,children:d(M,{children:[t(b,{md:4}),t(b,{md:4,children:t("h1",{children:"Cr\xE9ation de la partie..."})}),t(b,{md:4})]})})}const ie=e=>{const{gameStatus:n}=e;let a=t("h1",{children:"Chargement de la partie..."});return n.status==="ERROR"&&(a=t(oe,{variant:"danger",heading:"Erreur lors du chargement de la partie",message:n.message,onDismiss:e.onAlertDismiss,footer:"(Re)Connexion en cours... Fermez cette alerte si vous souhaitez retourner au menu."})),t(F,{vcenter:!0,children:d(M,{children:[t(b,{md:4}),t(b,{md:4,children:a}),t(b,{md:4})]})})};ie.propTypes={gameStatus:f.object.isRequired,onAlertDismiss:f.func};function Le(e){const[n,a]=g.exports.useState("secondary"),{gameData:o,onStart:r}=e;if(o.creatorId!==P())return t("div",{className:"game-pending-container",children:d(I,{children:[t(I.Header,{as:"h5",children:"En attente du d\xE9but de partie"}),t(I.Body,{children:"Vous pouvez \xE9changer sur le chat pendant ce temps !"})]})});const i=()=>{navigator.clipboard.writeText(o.url),a("success"),setTimeout(()=>{a("secondary")},800)};return d("div",{className:"game-pending-container",children:[d(I,{children:[t(I.Header,{as:"h5",children:"Invitez d'autres joueurs avec ce lien"}),d(I.Body,{children:[o.url,"\xA0\xA0",t(R,{title:"Copiez le lien",onClick:i,variant:n,children:t(Ze,{})})]})]}),t("div",{style:{paddingTop:"2vh"},children:t(R,{onClick:r,variant:"primary",children:"Lancer la partie !"})})]})}Le.propTypes={gameData:f.object.isRequired,onStart:f.func.isRequired};const{sqrt:St,max:Nt,ceil:Ct}=Math,se=()=>{let e=512,n=4;window.innerWidth<550&&(e=256,n=2);let a=e/n;return{maxSize:e,minSize:n,dim:a}};function Be(e,n){let a=[];return function(o,r,i){if(!(o<0||r<0)){if(arguments.length===3)return a[e*o+r]=i;if(arguments.length===2)return a[e*o+r];throw new TypeError("Bad number of arguments")}}}function wt(e,n,a,o){return[(e[0]+n[0]+a[0]+o[0])/4,(e[1]+n[1]+a[1]+o[1])/4,(e[2]+n[2]+a[2]+o[2])/4]}function It(e,n){let a=n[0]-e[0],o=n[1]-e[1];return St(a*a+o*o)}function Et(e,n,a){let o=[],r=It(e,n),i=Nt(Ct(r/a),1),s=(n[0]-e[0])/i,l=(n[1]-e[1])/i,c=e[0],u=e[1];for(let x=0;x<=i;x++)o.push([c+s*x,u+l*x]);return o}function Oe(e,n,a){var o,r=null;return function(){var i=a||this,s=arguments,l=function(){r=null},c=!r;return c&&(r&&clearTimeout(r),r=setTimeout(l,n),o=e.apply(i,s)),o}}function Rt(e,n,a,o){this.container=j(e),this.vis=this.container.append("svg").attr("width",n).attr("height",n),this.size=n,this.startAt=a,this.changeIntervalId=null,this._text=null,this.vis.append("circle").attr("cx",n/2).attr("cy",n/2).attr("r",`${n/2}px`).style("fill","#6c757d").style("opacity","0").transition().duration(800).style("opacity","1");const r=this.startAt-$(),i=r>0?`${r}`:"0";this._text=this.vis.append("text").attr("x",n/2).attr("y",n/2).attr("text-anchor","middle").attr("dominant-baseline","central").text(i).style("font-size",n>=512?"20em":"10em").style("font-weight","normal").style("fill","#eee"),this._text.style("opacity","0").transition().duration(800).style("opacity","1");function s(){if(!this._text)return;const l=this.startAt-$();if(l<=0){this._text.text("0"),this.changeIntervalId&&(clearInterval(this.changeIntervalId),this.changeIntervalId=null,this._text=null),this.container.selectAll("*").remove(),o();return}const c=`${l}`;this._text.text(c)}this.changeIntervalId=setInterval(s.bind(this),100)}function z(e,n,a,o,r,i,s){this.id=`${o}-${n}-${a}`,this.vis=e,this.x=o*(n+.5),this.y=o*(a+.5),this.size=o,this.color=r,this.rgb=et(r[0],r[1],r[2]),this.children=i,this.layer=s}z.prototype.isSplitable=function(){return this.node&&this.children&&this.appearedAt&&Date.now()-this.appearedAt>300};z.prototype.split=function(){!this.isSplitable()||setTimeout(()=>{j(this.node).remove(),delete this.node,z.addToVis(this.vis,this.children)},0)};z.prototype.checkIntersection=function(e,n){let a=this.x-n[0],o=this.y-n[1],r=this.x-e[0],i=this.y-e[1],s=this.size/2;return s=s*s,a*a+o*o<=s&&r*r+i*i>s};z.addToVis=function(e,n,a){let o=e.selectAll(".nope").data(n).enter().append("circle");o=o.attr("cx",function(r){return r.x}).attr("cy",function(r){return r.y}),a?o=o.attr("r",4).attr("fill","#ffffff").transition().duration(1e3).attr("r",function(r){return r.size/2}).attr("fill",function(r){return String(r.rgb)}).attr("fill-opacity",1).each(function(r){r.node=this,r.appearedAt=Date.now()-1e3}):o=o.attr("r",function(r){return r.parent.size/2}).attr("fill",function(r){return String(r.parent.rgb)}).attr("fill-opacity",.68).transition().duration(200).attr("r",function(r){return r.size/2}).attr("fill",function(r){return String(r.rgb)}).attr("fill-opacity",1).each(function(r){r.node=this,r.appearedAt=Date.now()})};const{floor:Pe}=Math,L={version:"2.0.0"};(function(){L.supportsCanvas=function(){var n=document.createElement("canvas");return!!(n.getContext&&n.getContext("2d"))},L.supportsSVG=function(){return!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect},L.clear=function(){!!L.current};let e;L.loadImage=function(n){const{maxSize:a,minSize:o,dim:r}=se();var i=document.createElement("canvas").getContext("2d");return i.drawImage(n,0,0,r,r),i.getImageData(0,0,r,r).data},L.makeLoadingCircle=function(n,a,o=()=>{}){const{maxSize:r,minSize:i,dim:s}=se();j(n).selectAll("*").remove(),new Rt(n,r,a,o)},L.makeCircles=function(n,a){let{maxSize:o,minSize:r,dim:i}=se();e?e.selectAll("circle").remove():e=j(n).append("svg").attr("width",o).attr("height",o);let s=Be(i),l=r,c,u,x=0,T;for(u=0;u<i;u++)for(c=0;c<i;c++)T=[a[x],a[x+1],a[x+2]],s(c,u,new z(e,c,u,l,T)),x+=4;let B,h=s,G,w,S,m,v=0;for(;l<o;){for(i/=2,l=l*2,B=Be(i),u=0;u<i;u++)for(c=0;c<i;c++)G=h(2*c,2*u),w=h(2*c+1,2*u),S=h(2*c,2*u+1),m=h(2*c+1,2*u+1),T=wt(G.color,w.color,S.color,m.color),G.parent=w.parent=S.parent=m.parent=B(c,u,new z(e,c,u,l,T,[G,w,S,m],v));v++,h=B}z.addToVis(e,[B(0,0)],!0);function k(N){let E=Pe(N[0]/r),C=Pe(N[1]/r),y=s(E,C);if(!y)return null;for(;y&&!y.isSplitable();)y=y.parent;return y||null}const J=new Set;function ge(N,E){let C=Et(N,E,r/2);const y=new Set,W=[];for(let V=0;V<C.length-1;V++){let te=C[V],ve=C[V+1],O=k(ve);O&&!y.has(O.id)&&!J.has(O.id)&&(y.add(O.id),O.isSplitable()&&(O.size<=o*2||O.checkIntersection(te,ve))&&(J.add(O.id),W.push(O)))}return W}let Y=null;function je(N){let E=nt(N,e.node());if(N.preventDefault(),N.stopPropagation(),isNaN(E[0])){Y=null;return}if(Y){const C=ge(Y,E);C.length>0&&setTimeout(()=>{C.forEach(y=>{y.split()})},0)}Y=E}let ee={};function $e(N){let E=tt(N,e.node());N.preventDefault(),N.stopPropagation();for(let C=0;C<E.length;C++){let y=E[C];if(isNaN(y[0]))continue;let W=ee[y.identifier];if(W){const V=ge(W,y);V.length>0&&setTimeout(()=>{V.forEach(te=>{te.split()})},0)}ee[y.identifier]=y}}function pe(N){for(var E=N.changedTouches,C=0;C<E.length;C++){var y=E.item(C);ee[y.identifier]=null}N.preventDefault(),N.stopPropagation()}return j("#game-panel-container").on("mousemove.koala",Oe(je,40)).on("touchmove.koala",Oe($e,40)).on("touchend.koala",pe).on("touchcancel.koala",pe),function(){j("#game-panel-container").on("mousemove.koala",null).on("touchmove.koala",null).on("touchend.koala",null).on("touchcancel.koala",null),j(n).selectAll("*").remove(),e=null}}})();function Tt({url:e,startAt:n}){return g.exports.useEffect(()=>{const a={func:()=>{}};return(()=>{const r=new Image;r.crossOrigin="Anonymous",r.onload=function(){let i;try{i=L.loadImage(r)}catch(l){return console.warn(l),!1}if(!i)return!1;function s(){const l=L.makeCircles("#game-dots",i);a.func=()=>{l(),this&&this.remove()}}if($()<n){L.makeLoadingCircle("#game-dots",n,s.bind(this));return}else s()}.bind(r),r.src=e})(),()=>{a.func(),a.func=()=>{}}},[e]),t("div",{id:"game-dots"})}function ce({url:e,startAt:n}){return t("div",{id:"game-panel-container",className:"game-panel-container",children:t(Tt,{url:e,startAt:n})})}ce.propTypes={url:f.string.isRequired,startAt:f.number.isRequired};function le({id:e,senderId:n,senderName:a,message:o,createdAt:r,abridged:i}){let s=o;return i&&o.length>i&&(s=o.substring(0,i)+"..."),n?d(I,{className:"small-card-body chat-message",body:!0,children:[t(Ce,{bg:"secondary",children:a}),"\xA0",s]}):t(I,{className:"small-card-body chat-message",body:!0,children:t("i",{children:s})})}le.propTypes={id:f.number.isRequired,senderId:f.string,senderName:f.string.isRequired,message:f.string.isRequired,createdAt:f.string.isRequired};function Fe({messages:e}){return console.log("rerender chatBody",e),t("div",{className:"chat-body",children:t(rt,{className:"chat-messages",children:e.map(n=>t(le,D({},n),n.id))})})}Fe.propTypes={messages:f.array.isRequired};const de=gt("");function kt(){const[e,n]=g.exports.useState(de.get());return g.exports.useEffect(()=>de.subscribe(n),[]),[e,a=>de.set(a)]}function ue({onSubmit:e}){const[n,a]=kt();return t("input",{id:"chat-form-message",placeholder:"Envoyer un message",type:"textarea",className:"form-control",value:n,onChange:r=>{a(r.target.value)},onKeyDown:r=>{if(!(!r||!r.key)&&r.key==="Enter"){const i=(n||"").trim();if(i.length<1)return;e(i),a("")}}})}ue.propTypes={onSubmit:f.func};function qe({messages:e,onSubmit:n}){return d("div",{className:"chat-container",children:[t("div",{className:"chat-header-container"}),t("div",{className:"chat-body-container",children:t(Fe,{messages:e})}),t("div",{className:"chat-form-container",children:t(ue,{onSubmit:n})})]})}qe.propTypes={messages:f.array.isRequired,onSubmit:f.func.isRequired};function Dt({scoreboard:e}){e=e||{};const n=[];return Object.entries(e).forEach(([a,o])=>{n.push(o)}),n.sort((a,o)=>a.score>o.score?-1:a.score<o.score?1:0),d(at,{striped:!0,bordered:!0,hover:!0,size:"sm",children:[t("thead",{children:d("tr",{children:[t("th",{children:"Joueur"}),t("th",{children:"Score"})]})}),t("tbody",{children:n.map(a=>d("tr",{children:[t("td",{children:t(Ce,{bg:"secondary",children:a.name})}),t("td",{children:a.score})]}))})]})}function At({show:e,setShow:n,messages:a,chatSubmit:o,scoreboard:r}){let i=t("div",{children:"?"});return e==="chat"?i=t(qe,{messages:a,onSubmit:o}):e==="scoreboard"&&(i=t(Dt,{scoreboard:r})),d(Z,{show:e!==!1,onHide:()=>{n(!1)},placement:"end",children:[t(Z.Header,{closeButton:!0,children:t(Z.Title,{children:d(ot,{defaultActiveKey:"chat",className:"mb-3",activeKey:e,onSelect:s=>n(s),children:[t(we,{eventKey:"chat",title:"Chat"}),t(we,{eventKey:"scoreboard",title:"Scores",disabled:!r})]})})}),t(Z.Body,{children:i})]})}function Gt({messages:e,setShowOffCanvas:n,hasStarted:a,hasEnded:o,chatSubmit:r}){const i=Re();let s=[t(R,{variant:"primary",onClick:()=>{n("chat")},children:"Chat"},"chat-button")];if(a&&s.push(t(R,{variant:"primary",onClick:()=>{n("scoreboard")},children:"Scores"},"scores-button")),a&&!o&i[0]<1250)return t(Ie,{className:"p-1",position:"bottom-end",children:t(U,{children:t(U.Header,{closeButton:!1,children:t("div",{style:{display:"flex",justifyContent:"space-around",width:"100%"},children:s})})})});let l=t(I,{className:"small-card-body",body:!0,children:t("i",{children:"Aucun message"})});return e.length>0&&(l=t(le,D({abridged:75},e[e.length-1]))),t(Ie,{className:"p-3",position:a?"bottom-end":"bottom-center",children:d(U,{children:[d(U.Body,{children:[l,t(ue,{onSubmit:r})]}),t(U.Header,{closeButton:!1,children:t("div",{style:{display:"flex",justifyContent:"space-around",width:"100%"},children:s})})]})})}const ze=e=>{if(e<=0)return"Temps \xE9coul\xE9 !";const n=Math.floor(e/60),a=e%60;return n<1?`${a}s`:`${n}m ${a}s`},me=(()=>{let e=null;return{setId:n=>{e=n},getId:()=>e}})();function Mt({choices:e,onGuess:n,roundNumber:a,roundData:o,startAt:r,endAt:i}){const{hasCompletedRound:s,goodChoice:l,wrongChoices:c}=o,[u,x]=g.exports.useState({displayedMessage:"Le tour va bient\xF4t commencer",remainingTimeForStart:Math.max(r-$(),0),remainingTime:Math.max(i-$(),0)}),T=()=>{const h=me.getId();h&&(clearInterval(h),me.setId(null))};g.exports.useEffect(()=>{if(s){const w=D({},u);w.displayedMessage="Bien jou\xE9 ! les autres joueurs finissent leur tour...",w.remainingTime=-1,x(w);return}const h=()=>{if(s){T();return}const w=$(),S=i-w,m=D({},u);m.remainingTime=Math.max(i-w,0),m.remainingTimeForStart=Math.max(r-$(),0),m.remainingTimeForStart>0?a===1?m.displayedMessage="Grattez le cercle qui va appara\xEEtre pour le diviser et deviner l'image cach\xE9e !":m.displayedMessage=`Le tour ${a} va bient\xF4t commencer`:S>0?m.displayedMessage=`Devinez bien ! il vous reste ${ze(S)}`:(m.displayedMessage=`${ze(S)}`,T()),x(m)};h();const G=setInterval(h,1e3);return me.setId(G),()=>{T()}},[a,s,r,i]);const B=u.remainingTimeForStart>0||s||u.remainingTime===0;return d("div",{className:"game-footer-container",children:[t("div",{className:"game-footer-container",children:t("h3",{children:u.displayedMessage})}),t("div",{className:"game-footer-choices-container",children:e.map((h,G)=>{const w=B||h===l||c.includes(h);let S="outline-secondary";return h===l?S="outline-success":c.includes(h)&&(S="outline-danger"),t("div",{className:"game-footer-choice-container",children:t(R,{variant:S,disabled:w,onClick:()=>{n(h)},children:h})},`${a}-${h}`)})})]})}function Ve(e){const{gameData:n,onReset:a}=e,{scoreboard:o,rankings:r}=n;let i="La partie est finie !";if(Object.keys(o).length===1)i+=` Votre score est de ${r[0].score}`;else{const s=r[0],l=s.score,c=o[P()].score;c===l?s.players.length===1?i+=` Vous avez gagn\xE9 avec un score de ${c} !`:i+=` Vous gagnez ex-aequo avec un score de ${c} !`:i+=` Votre score est de ${c}`}return n.creatorId!==P()?t("div",{className:"game-footer-container",children:d("div",{className:"game-footer-container",children:[t("h3",{children:i}),t("h5",{children:"Le cr\xE9ateur de la partie peut en lancer une autre"})]})}):t("div",{className:"game-footer-container",children:d("div",{className:"game-footer-container",children:[t("h3",{children:i}),d("div",{className:"game-pending-container",children:[t(I,{children:t(I.Body,{children:t(R,{onClick:a,variant:"primary",children:"Lancer une nouvelle partie"})})}),t("div",{})]})]})})}Ve.propTypes={gameData:f.object.isRequired,onReset:f.func};function A(){let e=window.location.href.match(/\/(g_[^\/]+)$/);return e?e[1]:null}const he={goodChoice:null,hasCompletedRound:!1,wrongChoices:[]};function Lt(){const[e,n]=g.exports.useState(null),[a,o]=g.exports.useState(D({},he)),[r,i]=g.exports.useState([]),[s,l]=g.exports.useState(()=>()=>{}),[c,u]=g.exports.useState({status:"CONNECTING",message:null}),[x,T]=g.exports.useState(!1),B=_();if(!A())return window.location="/unknown-game",t(ie,{gameStatus:c});const h=q.getSocket("/game"),G=()=>{h.emit("loadGame",{playerId:P(),playerName:re(),gameId:A()}),u({status:"LOADING",message:null})},w=m=>{u({status:"CONNECTING",error:!0,message:m.message})};if(g.exports.useEffect(()=>{const m=A();return h.off("gameLoaded").on("gameLoaded",(...v)=>{if(v[0].error){B("/unknown-game");return}const k=v[0].data,J=k.chatMessages;k.chatMessages=null,n(k),J&&i(J),k.startedAt||o(D({},he)),u({status:"LOADED",message:null})}),h.connected?(console.log("deja co :)"),G()):(console.log("pas deja co"),h.off("connect").on("connect",G),h.off("connect_error").on("connect_error",w),h.connect()),function(){const k=q.getSocket("/game");k.off("gameLoaded"),k.off("chatMessages"),k.off("connect"),k.off("connect_error"),!!m&&(console.log("sending leaveGame notification to backend"),k.emit("leaveGame",{gameId:m}))}},[]),g.exports.useEffect(()=>{l(()=>m=>{h.emit("emitChatMessage",{gameId:A(),playerId:P(),playerName:re(),message:m})}),h.off("chatMessages").on("chatMessages",(...m)=>{if(m[0].gameId!==A())return;const v=[...r,...m[0].messages];i(v)})},[r]),g.exports.useEffect(()=>(h.off("gameStarted").on("gameStarted",(...m)=>{const v=m[0];v.gameId===A()&&(n(v),u({status:"STARTED",message:null}),T(!1))}),h.off("roundUpdate").on("roundUpdate",(...m)=>{const v=m[0];v.gameId===A()&&o(v.roundData)}),h.off("gameUpdate").on("gameUpdate",(...m)=>{const v=m[0];v.gameId===A()&&((!e.currentRound||e.currentRound.roundNumber!==v.currentRound.roundNumber)&&o(D({},he)),n(v))}),()=>{h.off("gameStarted"),h.off("roundUpdate"),h.off("gameUpdate")}),[e,a]),!e)return t(ie,{gameStatus:c,onAlertDismiss:()=>{q.getDefaultSocket().disconnect(),q.getSocket("/game").disconnect(),B("/")}});let S=t("div",{children:"Game"});if(e.startedAt)if(e.endedAt){let m=()=>{};P()===e.creatorId&&(m=()=>{h.emit("resetGame",{gameId:A()})}),S=d(ne,{children:[t(ce,{url:e.currentRound.image.url,startAt:e.currentRound.startAt}),t(Ve,{gameData:e,onReset:m})]})}else{const m=v=>{h.emit("submitGuess",{gameId:A(),guess:v})};S=d(ne,{children:[t(ce,{url:e.currentRound.image.url,startAt:e.currentRound.startAt}),t(Mt,{choices:e.currentRound.image.choices,startAt:e.currentRound.startAt,endAt:e.currentRound.endAt,roundNumber:e.currentRound.roundNumber,roundData:a,onGuess:m})]})}else{let m=()=>{};P()===e.creatorId&&(m=()=>{h.emit("startGame",{gameId:A()})}),S=t(Le,{gameData:e,onStart:m})}return d(F,{children:[t("div",{className:"game-container",children:S}),t(Gt,{messages:r,hasStarted:!!e.startedAt,hasEnded:!!e.endedAt,setShowOffCanvas:T,chatSubmit:s}),t(At,{show:x,setShow:T,messages:r,chatSubmit:s,scoreboard:e.scoreboard})]})}function fe(e){const n=_();return g.exports.useEffect(()=>{setTimeout(()=>{n("/")},1500)},[]),t(F,{vcenter:!0,children:d(M,{children:[t(b,{md:4}),d(b,{md:4,children:[t("h1",{children:e.game?"Partie non trouv\xE9e":"Page non trouv\xE9e"}),t("hr",{}),d("h3",{children:["Vous allez \xEAtre redirig\xE9 vers le ",t(it,{to:"/",children:"menu"}),"..."]})]}),t(b,{md:4})]})})}fe.propTypes={game:f.any};function Bt(){return window.location.pathname!=="/"&&window.location.pathname!==""&&!ft()?(window.location="/",t(Ge,{})):t(st,{children:d(ct,{children:[t(H,{exact:!0,path:"/",element:t(Ge,{})}),t(H,{exact:!0,path:"/game-configuration",element:t(yt,{})}),t(H,{exact:!0,path:"/new-game",element:t(xt,{})}),t(H,{path:"/game/*",element:t(Lt,{})}),t(H,{exact:!0,path:"/unknown-game",element:t(fe,{game:!0})}),t(H,{path:"*",element:t(fe,{})})]})})}mt()||ht();lt.render(t(dt.StrictMode,{children:t(Bt,{})}),document.getElementById("root"));
